# 📈 AIparameter 股票指标参数优化与回测系统

一个基于Python的股票技术指标参数优化与历史回测系统，通过算法搜索最优参数组合，辅助确定股票交易策略的最佳参数配置。

## ✨ 功能特性

- **📊 多数据源支持**: 使用akshare接口获取A股历史行情数据，支持前复权处理
- **📈 丰富技术指标**: 基于TA-Lib实现30+常见技术指标（MACD、RSI、KDJ、布林带等）
- **⚙️ 智能参数优化**: 支持网格搜索和遗传算法两种优化方式
- **🔧 完整回测引擎**: 包含买卖信号逻辑、仓位管理、绩效计算等功能
- **🎨 交互式界面**: 基于Streamlit构建的现代化Web界面
- **🚀 高性能计算**: 支持并行处理，优化计算效率

## 🛠️ 技术栈

- **编程语言**: Python 3.11
- **包管理**: uv
- **数据获取**: akshare
- **技术指标**: TA-Lib, ta
- **优化算法**: scikit-learn, DEAP
- **前端框架**: Streamlit
- **可视化**: Plotly, Matplotlib

## 🔧 应用截图

![alt text](/png/image.png)
![alt text](/png/image-1.png)

## 📦 安装依赖

使用uv安装所有依赖：

```bash
uv sync
```

或者使用pip安装：

```bash
pip install -r requirements.txt
```

## 🚀 快速开始

1. **启动应用**:
   ```bash
   streamlit run app.py
   ```

2. **在浏览器中打开**: http://localhost:8501

3. **配置参数**:
   - 输入股票代码（如：000001.SZ）
   - 选择时间周期和回测范围
   - 选择技术指标和优化算法
   - 设置参数搜索范围
   - 点击"开始参数优化"按钮

## 📁 项目结构

```
stock_optimizer/
├── app.py                 # 主应用程序入口
├── requirements.txt       # 项目依赖
├── README.md             # 项目文档
├── data/                 # 数据获取模块
│   ├── __init__.py
│   └── data_fetcher.py   # 股票数据获取器
├── indicators/           # 技术指标模块
│   ├── __init__.py
│   └── technical_indicators.py  # 技术指标计算
├── backtest/             # 回测引擎模块
│   ├── __init__.py
│   └── backtest_engine.py      # 回测逻辑
└── optimization/        # 参数优化模块
    ├── __init__.py
    └── optimizer.py           # 优化算法
```

## 🎯 核心功能

### 1. 数据获取模块
- 支持A股股票代码（000001.SZ格式）
- 自动处理前复权数据
- 支持日线、周线、月线多种时间周期
- 异常处理和错误提示

### 2. 技术指标计算
- **MACD**: 移动平均收敛发散指标
- **RSI**: 相对强弱指数
- **KDJ**: 随机指标
- **布林带**: 波动率指标
- **均线**: 移动平均线
- **乖离率**: 价格偏离度指标

### 3. 参数优化算法
- **网格搜索**: 全面搜索参数空间，找到全局最优解
- **遗传算法**: 智能优化算法，适合大参数空间搜索
- 并行计算支持，提升优化效率

### 4. 回测引擎
- **交易信号**: 基于指标规则生成买卖信号
- **仓位管理**: 全仓操作，单次交易仅持有1个仓位
- **绩效计算**: 
  - 年化收益率、总收益率
  - 胜率、最大回撤
  - 夏普比率、索提诺比率
  - 交易次数、持仓时间分析

### 5. 前端交互
- **输入区**: 股票代码、时间范围、指标选择、参数设置
- **结果展示**: 
  - 最优参数组合及绩效指标
  - 所有参数组合排序
  - 回测净值曲线可视化
  - 买卖信号标记

## ⚙️ 配置说明

### 参数范围设置

不同指标的默认参数搜索范围：

| 指标 | 参数 | 范围 | 步长 |
|------|------|------|------|
| MACD | fastperiod | 5-20 | 2 |
| MACD | slowperiod | 15-40 | 5 |
| MACD | signalperiod | 3-15 | 2 |
| RSI | timeperiod | 6-30 | 2 |
| KDJ | fastk_period | 5-15 | 2 |
| KDJ | slowk_period | 2-5 | 1 |
| KDJ | slowd_period | 2-5 | 1 |

### 性能优化

- 对于1年日线数据、1000+参数组合的场景，优化计算时间不超过30秒
- 支持多核并行计算，充分利用硬件资源
- 内存优化处理，支持大规模数据回测

## 🎨 界面预览

系统提供直观的Web界面，包含：
- 侧边栏参数配置区域
- 数据预览表格
- 优化结果展示
- 绩效指标表格
- 可视化图表（净值曲线、买卖信号）

## 🔧 扩展开发

### 添加新指标

1. 在 `technical_indicators.py` 中添加指标计算方法
2. 在 `indicators_info` 字典中注册指标信息
3. 在优化器中添加对应的参数范围

### 扩展数据源

修改 `data_fetcher.py` 中的数据获取逻辑，支持更多数据源接口。

### 自定义优化目标

在 `optimizer.py` 中修改 `objective` 参数，支持不同的优化目标函数。

## 📊 性能指标说明

- **年化收益率**: 策略的年化回报率
- **夏普比率**: 风险调整后的收益指标
- **最大回撤**: 策略的最大亏损幅度
- **胜率**: 盈利交易占总交易的比例
- **交易次数**: 策略执行的总交易次数

## 🐛 常见问题

### Q: 数据获取失败怎么办？
A: 检查网络连接，确认akshare库正常工作，验证股票代码格式是否正确。

### Q: 优化计算时间太长？
A: 可以减小参数搜索范围，或者使用遗传算法代替网格搜索。

### Q: 如何添加自定义指标？
A: 参考现有指标的实现方式，在 `technical_indicators.py` 中添加新的指标计算方法。

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📞 支持

如有问题，请提交Issue或联系开发团队。
联系方式：yl_zhangqiang@foxmail.com